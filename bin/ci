#!/bin/sh -exu

PROJECT=${1:?"'ci' requires a single argument, specifying the mismi sub-project."}
$(dirname $0)/ci.common $PROJECT

cd $PROJECT
cabal haddock --hoogle

VERSION=$(cat $(dirname $0)/../$PROJECT/dist/build/autogen/version.txt)
aws s3 --region=ap-southeast-2 cp --recursive dist/doc/html/ambiata-$PROJECT/ s3://ambiata-doc/ambiata-$PROJECT-haddock/$VERSION

if [ $PROJECT = "mismi-s3" ] ; then
    aws s3 --region=ap-southeast-2 cp mismi-s3/dist/build/s3/s3 s3://ambiata-dist/s3/linux/x86_64/$VERSION/s3-$VERSION
fi
