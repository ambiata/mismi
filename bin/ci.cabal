#!/bin/sh -exu

export LC_COLLATE=en_US.UTF-8
export LANG=en_US.UTF-8

git submodule init
git submodule sync
git submodule update

cabal sandbox delete

./cabal update
./cabal build
cabal install

(
    cd test && \
      cabal sandbox init --sandbox ../.cabal-sandbox && \
      cabal configure && \
      cabal install
) || exit $?
